<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Calculator Test</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
    .form-group { margin: 15px 0; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    button { padding: 15px 30px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    #result { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; display: none; }
  </style>
</head>
<body>
  <h1>Simple Bench Press Calculator</h1>
  
  <form id="calculator-form">
    <div class="form-group">
      <label for="gender">Gender:</label>
      <select id="gender" required>
        <option value="">Select gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="age">Age:</label>
      <input type="number" id="age" placeholder="Enter age" min="15" max="90" required>
      <small style="color: #666; font-size: 0.8rem;">Age range: 15-90 years</small>
    </div>
    
    <div class="form-group">
      <label for="weight">Weight (lbs):</label>
      <input type="number" id="weight" placeholder="Enter weight" min="110" max="310" required>
      <small style="color: #666; font-size: 0.8rem;">Weight range: 110-310 lbs</small>
    </div>
    
    <div class="form-group">
      <label for="bench">Bench Press Max (lbs):</label>
      <input type="number" id="bench" placeholder="Enter bench press max" min="1" max="1000" required>
      <small style="color: #666; font-size: 0.8rem;">Bench press range: 1-1000 lbs</small>
    </div>
    
    <div class="form-group">
      <label for="compareBy">Compare by:</label>
      <select id="compareBy" required>
        <option value="">Select comparison</option>
        <option value="by_age">Age</option>
        <option value="by_weight">Weight</option>
      </select>
    </div>
    
    <button type="submit">Calculate</button>
  </form>
  
  <div id="result">
    <h3>Results:</h3>
    <p><strong>Percentile:</strong> <span id="percentile-value">-</span></p>
    <p><strong>Strength Level:</strong> <span id="strength-level">-</span></p>
    <p><strong>Details:</strong> <span id="comparison-details">-</span></p>
  </div>

  <script>
    async function fetchData() {
      try {
        console.log('Fetching data...');
        const response = await fetch('data/percentiles.json');
        if (!response.ok) {
          throw new Error('Failed to fetch data: ' + response.status);
        }
        const data = await response.json();
        console.log('Data loaded successfully');
        return data;
      } catch (error) {
        console.error('Error:', error);
        throw error;
      }
    }

    function interpolate(data, bench) {
      if (!data || data.length === 0) return 0;
      
      if (bench <= data[0].bench) return data[0].percentile;
      if (bench >= data[data.length - 1].bench) return data[data.length - 1].percentile;
      
      for (let i = 0; i < data.length - 1; i++) {
        const a = data[i];
        const b = data[i + 1];
        
        if (bench >= a.bench && bench <= b.bench) {
          const ratio = (bench - a.bench) / (b.bench - a.bench);
          return Math.round(a.percentile + ratio * (b.percentile - a.percentile));
        }
      }
      return 0;
    }

    function getStrengthLevel(percentile) {
      if (percentile >= 95) return "World Class";
      if (percentile >= 80) return "Elite";
      if (percentile >= 50) return "Advanced";
      if (percentile >= 20) return "Intermediate";
      if (percentile >= 5) return "Novice";
      return "Beginner";
    }

    function getWeightRange(weight) {
      const ranges = ["110", "120", "130", "140", "150", "160", "170", "180", "190", "200", "210", "220", "230", "240", "250", "260", "270", "280", "290", "300", "310"];
      let closest = ranges[0];
      let minDiff = Math.abs(weight - parseInt(closest));
      
      for (let range of ranges) {
        const diff = Math.abs(weight - parseInt(range));
        if (diff < minDiff) {
          minDiff = diff;
          closest = range;
        }
      }
      return closest;
    }

    document.getElementById('calculator-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      console.log('Form submitted');
      
      const age = parseInt(document.getElementById('age').value);
      const weight = parseInt(document.getElementById('weight').value);
      const gender = document.getElementById('gender').value;
      const bench = parseInt(document.getElementById('bench').value);
      const compareBy = document.getElementById('compareBy').value;
      
      console.log('Form values:', { age, weight, gender, bench, compareBy });
      
      if (!age || !weight || !gender || !bench || !compareBy) {
        alert('Please fill in all fields');
        return;
      }
      
      // Validate ranges
      if (age < 15 || age > 90) {
        alert('Age must be between 15 and 90 years');
        return;
      }
      
      if (weight < 110 || weight > 310) {
        alert('Weight must be between 110 and 310 lbs');
        return;
      }
      
      if (bench < 1 || bench > 1000) {
        alert('Bench press must be between 1 and 1000 lbs');
        return;
      }
      
      // Additional realistic validation
      if (bench > weight * 2) {
        alert('Bench press cannot be more than twice your body weight. Please check your input.');
        return;
      }
      
      if (bench < weight * 0.1) {
        alert('Bench press seems very low for your weight. Please check your input.');
        return;
      }
      
      try {
        const data = await fetchData();
        let dataset;
        let comparisonDetails = '';
        
        if (compareBy === "by_age") {
          const ages = Object.keys(data.by_age[gender]).map(Number).sort((a, b) => a - b);
          let closestAge = ages[0];
          let minDiff = Math.abs(age - closestAge);
          
          for (let ageKey of ages) {
            const diff = Math.abs(age - ageKey);
            if (diff < minDiff) {
              minDiff = diff;
              closestAge = ageKey;
            }
          }
          
          dataset = data.by_age[gender][closestAge.toString()];
          comparisonDetails = `Compared to ${gender}s aged ${closestAge} years`;
          
        } else if (compareBy === "by_weight") {
          const weightRange = getWeightRange(weight);
          dataset = data.by_weight[gender][weightRange];
          comparisonDetails = `Compared to ${gender}s weighing around ${weightRange} lbs`;
        }
        
        const percentile = interpolate(dataset, bench);
        const strengthLevel = getStrengthLevel(percentile);
        
        console.log('Results:', { percentile, strengthLevel });
        
        document.getElementById('percentile-value').textContent = percentile + 'th';
        document.getElementById('strength-level').textContent = strengthLevel;
        document.getElementById('comparison-details').textContent = comparisonDetails;
        
        document.getElementById('result').style.display = 'block';
        
      } catch (error) {
        console.error('Error:', error);
        alert('Error: ' + error.message);
      }
    });
  </script>
</body>
</html> 